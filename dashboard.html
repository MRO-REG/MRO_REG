<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema MRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Reset e Estilo Geral */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Barra Lateral */
        .sidebar {
            width: 260px;
            background: rgba(25, 25, 35, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 3px 0 15px rgba(0,0,0,0.2);
            z-index: 100;
        }
        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo h1 {
            font-size: 24px;
            color: #4CAF50;
        }
        .logo p {
            font-size: 14px;
            color: #aaa;
        }
        .sidebar-nav {
            flex: 1;
        }
        .nav-item {
            display: block;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ddd;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(76, 175, 80, 0.2);
            color: white;
        }
        .nav-item i {
            width: 24px;
            text-align: center;
        }

        /* Conte√∫do Principal */
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(245, 245, 245, 0.95);
            backdrop-filter: blur(10px);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border, #ddd);
        }
        .header-title h1 {
            color: var(--dark, #333);
            font-size: 28px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary, #4CAF50);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .clock-display {
            font-size: 18px;
            font-weight: bold;
            color: var(--dark, #333);
            font-family: 'Courier New', monospace;
        }

        /* P√°ginas */
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .page-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border, #ddd);
        }
        .page-header h1 {
            color: var(--dark, #333);
            font-size: 24px;
        }
        .page-header p {
            color: #666;
            margin-top: 5px;
        }

        /* Bot√µes */
        .btn-primary {
            display: inline-block;
            background: var(--primary, #4CAF50);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
        }
        .btn-primary:hover {
            background: #45a049;
        }

        /* Tabelas e Iframes */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-height: 70vh; /* Limita a altura */
            overflow: auto; /* Adiciona rolagem se necess√°rio */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        tr:hover {
            background: #f5f5f5;
        }

        /* Documentos */
        .documents-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .document-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
            cursor: pointer;
        }
        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .document-icon {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        .document-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }
        .document-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .document-size {
            font-size: 12px;
            color: #999;
        }

        /* Cat√°logo - Estilo da √Årvore */
        .tree-container ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .tree-container li {
            margin: 5px 0;
        }
        .tree-item {
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            cursor: pointer;
        }
        .tree-item:hover {
            background: #e9e9e9;
        }

        /* Relat√≥rios */
        .report-section {
            margin-bottom: 30px;
        }
        .report-section h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }
        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .report-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .report-card i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Passagem de Servi√ßo - Calend√°rio */
        .calendar-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: var(--light, #f8f9fa);
        }
        .calendar-day {
            padding: 10px;
            border: 1px solid #eee;
            min-height: 80px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .calendar-day:hover {
            background: #f0f0f0;
        }
        .calendar-day.today {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        .calendar-day.weekend {
            background: #fff3e0;
        }
        .calendar-day.holiday {
            background: #ffebee;
        }
        .calendar-day-content {
            font-size: 12px;
        }

        /* Passagem de Servi√ßo - Filtros */
        .filters-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .filters-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        .filter-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Passagem de Servi√ßo - Tabela */
        .passagem-table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-height: 50vh; /* Limita a altura da tabela */
            overflow: auto; /* Adiciona rolagem se necess√°rio */
        }

        /* Plant√£o */
        .plantao-calendar-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            overflow-x: auto; /* Rolagem horizontal se necess√°rio */
        }
        .plantao-calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .plantao-calendar-grid {
            display: grid;
            grid-template-columns: repeat(31, 1fr); /* 31 dias */
            gap: 2px;
            min-width: max-content; /* Garante largura m√≠nima */
        }
        .plantao-calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background: var(--light, #f8f9fa);
            writing-mode: vertical-rl; /* Texto vertical */
            text-orientation: mixed;
            min-width: 40px; /* Largura fixa para cabe√ßalho */
            height: 100px; /* Altura para acomodar o texto vertical */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .plantao-calendar-day {
            padding: 8px;
            border: 1px solid #eee;
            min-height: 80px;
            min-width: 40px; /* Largura fixa para c√©lulas */
            cursor: pointer;
            transition: background 0.2s;
        }
        .plantao-calendar-day:hover {
            background: #f0f0f0;
        }
        .plantao-calendar-day.today {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        .plantao-calendar-day-content {
            font-size: 10px; /* Fonte menor para caber mais info */
        }

        /* Motiva√ß√£o */
        .motivational-quote {
            margin-top: auto;
            padding-top: 30px;
            border-top: 2px solid var(--border, #ddd);
            text-align: center;
            color: var(--dark, #333);
            font-style: italic;
            font-size: 16px;
            font-weight: 600;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
        }

        /* Carregamento */
        .loading {
            color: var(--primary, #4CAF50);
        }

        /* Vari√°veis CSS */
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --dark: #333;
            --light: #f8f9fa;
            --border: #ddd;
        }

        /* Estilo do Modal de Perfil */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            background: none;
            border: none;
        }
        .modal-close:hover {
            color: #000;
        }
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .modal-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }
        .modal-value {
            color: #333;
            word-break: break-all; /* Quebra palavras longas */
        }
        .modal-link {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
        }
        .modal-link:hover {
            background: #45a049;
        }

        /* Estilo do Modal de Filtro de Passagem (Antigo - Removido) */
        .resumo-passagem { display: none; }

    </style>
</head>
<body>

    <!-- Barra Lateral -->
    <nav class="sidebar">
        <div class="logo">
            <h1> <i class="fas fa-train"></i> MRO - Frota</h1>
            <p>Manuten√ß√£o, Seguran√ßa & Opera√ß√µes</p>
        </div>
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="showPage('dashboard', event)">
                <i class="fas fa-home"></i> <span class="nav-label">Dashboard</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('programacao', event)">
                <i class="fas fa-calendar-alt"></i> <span class="nav-label">Programa√ß√£o</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('documentacao', event)">
                <i class="fas fa-file-alt"></i> <span class="nav-label">Documenta√ß√£o</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('catalogo', event)">
                <i class="fas fa-boxes"></i> <span class="nav-label">Cat√°logo de Materiais</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('passagem', event)">
                <i class="fas fa-exchange-alt"></i> <span class="nav-label">Passagem de Servi√ßo</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('relatorios', event)">
                <i class="fas fa-chart-bar"></i> <span class="nav-label">Relat√≥rios</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('usuarios', event)">
                <i class="fas fa-users"></i> <span class="nav-label">Usu√°rios</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('rastreabilidade', event)">
                <i class="fas fa-search-location"></i> <span class="nav-label">Rastreabilidade</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('laboratorio', event)">
                <i class="fas fa-flask"></i> <span class="nav-label">Laborat√≥rio</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('eva', event)">
                <i class="fas fa-robot"></i> <span class="nav-label">EVA</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('frota', event)"> <!-- NOVO ITEM DE MENU -->
                <i class="fas fa-train"></i> <span class="nav-label">üöÜPlano de Frota</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('documentacao', event)">
                <i class="fas fa-file-contract"></i> <span class="nav-label">Documenta√ß√£o</span>
            </a>
            <button style="width: 100%; padding: 12px; margin-top: auto; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <div class="content">
        <div class="header">
            <div class="header-title">
                <h1 id="pageTitle">Dashboard</h1>
            </div>
            <div class="user-info">
                <div class="clock-display" id="operationClock">
                    <!-- Rel√≥gio preenchido via JS -->
                </div>
                <div class="user-avatar" id="userInitials" onclick="openProfileModal()">
                    <!-- Iniciais preenchidas via JS -->
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="page active" id="dashboard">
            <div class="page-header">
                <h1> <i class="fas fa-home"></i> Dashboard</h1>
                <p>Bem-vindo ao Sistema de Manuten√ß√£o, Seguran√ßa e Opera√ß√µes</p>
            </div>
            <div class="motivational-quote" id="motivationalQuote">
                <!-- Frase Motivacional carregada via JS -->
            </div>
        </div>
        <!-- /Dashboard -->

        <!-- Programa√ß√£o -->
        <div class="page" id="programacao">
            <div class="page-header">
                <h1> <i class="fas fa-calendar-alt"></i> Programa√ß√£o</h1>
                <p>Escalas e turnos da equipe</p>
            </div>
            <div style="margin-bottom: 20px;">
                <a href="https://docs.google.com/spreadsheets/d/1d4ZgT4J54m7Q4Y5mW0wQ4Y5mW0wQ4Y5mW0wQ4Y5mW0w/edit#gid=0" target="_blank" class="btn-primary">
                    <i class="fas fa-table"></i> Acessar Planilha Original
                </a>
            </div>
            <div class="table-container">
                <iframe id="programacao-iframe" src="" width="100%" height="600px" frameborder="0"></iframe>
            </div>
        </div>
        <!-- /Programa√ß√£o -->

        <!-- Documenta√ß√£o -->
        <div class="page" id="documentacao">
            <div class="page-header">
                <h1> <i class="fas fa-file-alt"></i> Documenta√ß√£o</h1>
                <p>Manuais, procedimentos e arquivos t√©cnicos</p>
            </div>
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchDocumentacao" placeholder="Buscar documentos..." onkeyup="searchDocuments()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="documents-container" id="documentsList">
                <!-- Documentos preenchidos via JS -->
            </div>
        </div>
        <!-- /Documenta√ß√£o -->

        <!-- Cat√°logo de Materiais -->
        <div class="page" id="catalogo">
            <div class="page-header">
                <h1> <i class="fas fa-boxes"></i> Cat√°logo de Materiais</h1>
                <p>Estrutura e componentes da frota</p>
            </div>
            <div style="margin-bottom: 20px;">
                <a href="https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/1MRO_FROTA.CITADIS402.json" target="_blank" class="btn-primary">
                    <i class="fas fa-file-code"></i> Acessar Estrutura JSON
                </a>
            </div>
            <div class="table-container">
                <div id="treeDisplay" class="tree-container">
                    <!-- √Årvore preenchida via JS -->
                </div>
            </div>
        </div>
        <!-- /Cat√°logo de Materiais -->

        <!-- Passagem de Servi√ßo -->
        <div class="page" id="passagem">
            <div class="page-header">
                <h1> <i class="fas fa-exchange-alt"></i> Passagem de Servi√ßo</h1>
                <p>Registros de falhas e status dos trens</p>
            </div>
            <div class="filters-container">
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="passagemData">Data:</label>
                        <input type="date" id="passagemData" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label for="passagemGrupo">Grupo:</label>
                        <select id="passagemGrupo" class="filter-input">
                            <option value="">Todos</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="passagemTrem">Trem:</label>
                        <input type="text" id="passagemTrem" class="filter-input" placeholder="Ex: VLT 101">
                    </div>
                </div>
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="passagemSistema">Sistema:</label>
                        <input type="text" id="passagemSistema" class="filter-input" placeholder="Ex: Tra√ß√£o">
                    </div>
                    <div class="filter-group">
                        <label for="passagemTecnico">T√©cnico:</label>
                        <input type="text" id="passagemTecnico" class="filter-input" placeholder="Nome do T√©cnico">
                    </div>
                    <div class="filter-group">
                        <label for="passagemStatus">Status:</label>
                        <select id="passagemStatus" class="filter-input">
                            <option value="">Todos</option>
                            <option value="PENDENTE">Pendente</option>
                            <option value="EM ANDAMENTO">Em Andamento</option>
                            <option value="RESOLVIDO">Resolvido</option>
                        </select>
                    </div>
                </div>
                <div class="filters-row" style="justify-content: center;">
                    <button class="btn-primary" onclick="applyPassagemFilters()">Aplicar Filtros</button>
                    <button class="btn-primary" onclick="clearPassagemFilters()" style="background: #999; margin-left: 10px;">Limpar Filtros</button>
                </div>
            </div>
            <div class="passagem-table-container">
                <table id="passagem-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Nome</th>
                            <th>Trem</th>
                            <th>Sistema</th>
                            <th>Descri√ß√£o</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados preenchidos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- /Passagem de Servi√ßo -->

        <!-- Relat√≥rios -->
        <div class="page" id="relatorios">
            <div class="page-header">
                <h1> <i class="fas fa-chart-bar"></i> Relat√≥rios</h1>
                <p>Relat√≥rios de desempenho e an√°lise</p>
            </div>
            <div class="report-section">
                <h3><i class="fas fa-chart-line"></i> Desempenho Operacional</h3>
                <div class="report-grid">
                    <div class="report-card">
                        <i class="fas fa-clock"></i>
                        <h4>Horas Operacionais</h4>
                        <p id="horasOperacionais">0h</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Falhas Reportadas</h4>
                        <p id="falhasReportadas">0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-check-circle"></i>
                        <h4>Falhas Resolvidas</h4>
                        <p id="falhasResolvidas">0</p>
                    </div>
                </div>
            </div>
            <div class="report-section">
                <h3><i class="fas fa-tools"></i> Atividades de Manuten√ß√£o</h3>
                <div class="report-grid">
                    <div class="report-card">
                        <i class="fas fa-wrench"></i>
                        <h4>Manut. Preventiva</h4>
                        <p id="manutPreventiva">0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-cogs"></i>
                        <h4>Manut. Corretiva</h4>
                        <p id="manutCorretiva">0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-user-hard-hat"></i>
                        <h4>T√©cnicos Alocados</h4>
                        <p id="tecnicosAlocados">0</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Relat√≥rios -->

        <!-- Usu√°rios -->
        <div class="page" id="usuarios">
            <div class="page-header">
                <h1> <i class="fas fa-users"></i> Usu√°rios</h1>
                <p>Gerenciamento de contas e permiss√µes</p>
            </div>
            <div style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="addUser()"> <i class="fas fa-user-plus"></i> Adicionar Usu√°rio </button>
            </div>
            <div class="table-container">
                <table id="usuarios-table">
                    <thead>
                        <tr>
                            <th>Usu√°rio</th>
                            <th>Tipo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados preenchidos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- /Usu√°rios -->

        <!-- Rastreabilidade -->
        <div class="page" id="rastreabilidade">
            <div class="page-header">
                <h1> <i class="fas fa-search-location"></i> Rastreabilidade</h1>
                <p>Hist√≥rico e localiza√ß√£o de pe√ßas e equipamentos</p>
            </div>
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchRastreabilidade" placeholder="Buscar por c√≥digo, trem, etc." onkeyup="searchRastreabilidade()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="table-container">
                <table id="rastreabilidade-table">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descri√ß√£o</th>
                            <th>Trem</th>
                            <th>Localiza√ß√£o Atual</th>
                            <th>Data da √öltima Atualiza√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados preenchidos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- /Rastreabilidade -->

        <!-- Laborat√≥rio -->
        <div class="page" id="laboratorio">
            <div class="page-header">
                <h1> <i class="fas fa-flask"></i> Laborat√≥rio</h1>
                <p>An√°lises e testes de materiais e componentes</p>
            </div>
            <div style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="loadLaboratorioPage()"> <i class="fas fa-sync-alt"></i> Atualizar Dados </button>
            </div>
            <div class="table-container">
                <table id="laboratorio-table">
                    <thead>
                        <tr>
                            <th>ID do Teste</th>
                            <th>Componente</th>
                            <th>Resultado</th>
                            <th>Data</th>
                            <th>T√©cnico Respons√°vel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados preenchidos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- /Laborat√≥rio -->

        <!-- EVA -->
        <div class="page" id="eva">
            <div class="page-header">
                <h1> <i class="fas fa-robot"></i> EVA</h1>
                <p>Registros e atividades da equipe EVA</p>
            </div>
            <div style="margin-bottom: 20px;">
                <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQh0a-BMomvvOomRWYGlmoZSPG6ZuwF1jRXFrm8yhzMzizB9vWBgFiFBRyFBRRHQfVVoRppT3E8FBKS/pubhtml?gid=927195938&single=true" target="_blank" class="btn-primary">
                    <i class="fas fa-table"></i> Acessar Planilha EVA
                </a>
            </div>
            <div class="table-container">
                <iframe id="eva-iframe" src="" width="100%" height="600px" frameborder="0"></iframe>
            </div>
        </div>
        <!-- /EVA -->

        <!-- DOCUMENTA√á√ÉO (Repetida, mantida para compatibilidade) -->
        <div class="page" id="documentacao2">
            <div class="page-header">
                <h1> <i class="fas fa-file-contract"></i> Documenta√ß√£o T√©cnica</h1>
                <p>Contratos, especifica√ß√µes e normas</p>
            </div>
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchDocumentacao2" placeholder="Buscar documentos..." onkeyup="searchDocuments2()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="documents-container" id="documentsList2">
                <!-- Documentos preenchidos via JS -->
            </div>
        </div>
        <!-- /DOCUMENTA√á√ÉO -->

        <!-- NOVA ABA: Plano de Frota -->
        <div class="page" id="page-frota">
            <div class="page-header">
                <h1> <i class="fas fa-train"></i> üöÜ Plano de Frota</h1>
                <p>Acesse e visualize o plano de frota em tempo real.</p>
            </div>
            <div style="margin-bottom: 20px;">
                <!-- Bot√£o para acessar a planilha original -->
                <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTe1CnKo3StuV2ajHM7_MxXdVvcySPxsFPb93QOlwRoxh961iuNiieETY4HpJVSDKTm1o4qNjC5tJSH/pubhtml?gid=1380669578&single=true" target="_blank" class="btn-primary">
                    <i class="fas fa-table"></i> Acessar Planilha Original
                </a>
            </div>
            <!-- Container da tabela para manter o estilo -->
            <div class="table-container">
                <!-- Iframe que ser√° carregado pela fun√ß√£o JS -->
                <iframe id="frota-iframe" src="" width="100%" height="800px" frameborder="0" style="min-height: 500px;"></iframe>
            </div>
        </div>
        <!-- /Aba Plano de Frota -->

    </div> <!-- Fim do .content -->

    <!-- Modal Perfil -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeProfileModal()">‚úï</button>
            <div class="modal-title">üë§ Meu Perfil</div>
            <div class="modal-section">
                <div class="modal-label">Nome Completo</div>
                <div class="modal-value" id="perfil-nome">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Usu√°rio</div>
                <div class="modal-value" id="perfil-usuario">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Email</div>
                <div class="modal-value" id="perfil-email">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Telefone</div>
                <div class="modal-value" id="perfil-telefone">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Endere√ßo</div>
                <div class="modal-value" id="perfil-endereco">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Matr√≠cula</div>
                <div class="modal-value" id="perfil-matricula">-</div>
            </div>
            <div class="modal-section">
                <div class="modal-label">Tipo de Usu√°rio</div>
                <div class="modal-value" id="perfil-tipo">-</div>
            </div>
        </div>
    </div>
    <!-- /Modal Perfil -->

    <script>
        // VARI√ÅVEIS GLOBAIS (mantida)
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || { usuario: 'Visitante', tipo: 'USU√ÅRIO' };
        const REGISTRO_CSV = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/3MRO_PASSAGEM.CSV';
        const DOCUMENTOS_CSV = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/2MRO_DOCUMENTOS.CSV';
        const USUARIOS_JSON = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/0MRO_USUARIOS.json';
        const RASTREABILIDADE_CSV = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/4MRO_RASTREABILIDADE.CSV';
        const LABORATORIO_CSV = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/5MRO_LABORATORIO.CSV';
        const BASE_CADASTRO_URL = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/6MRO_BASECADASTRO.CSV';
        const PROJECT_DATA_URL = 'https://raw.githubusercontent.com/B33m0r3/MRO_REG/main/1MRO_FROTA.CITADIS402.json';
        let allRegistros = [];
        let allUsuarios = [];
        let allRastreabilidade = [];
        let allLaboratorio = [];
        let baseCadastroData = [];
        let projectTreeData = []; // Dados da √°rvore do cat√°logo
        let filteredPassagemData = [];
        let filteredRastreabilidadeData = [];
        let filteredLaboratorioData = [];

        // FRASES MOTIVACIONAIS (mantida)
        const motivationalQuotes = [
            "üí™ Excel√™ncia √© a jornada, n√£o o destino!",
            "üöÜ Seguran√ßa em primeiro lugar, sempre!",
            "üõ°Ô∏è Prote√ß√£o √© responsabilidade de todos!",
            "üîß Cada parafuso importa para a engrenagem do sucesso.",
            "ü¶∫MRO = SEGURAN√áA"
        ];

        // DADOS DAS LINHAS (mantida)
        const linhasData = {
            1: { cor: 'Azul', estacoes: { 'SDU': 'Santos Dumont', 'ACM': 'Ant√¥nio Carlos (MAM)', 'CIN': 'Cinel√¢ndia', 'CAR': 'Carioca', 'STS': 'Sete de Setembro', 'CAN': 'Candel√°ria', 'SAB': 'S√£o Bento', 'PAM': 'Parada dos Museus', 'PNV': 'Parada dos Navios (Valongo)', 'UAR': 'Utopia (AquaRio)', 'CDS': 'Cidade do Samba (Tia Ciata)', 'SCR': 'Santo Cristo', 'GAM': 'Gamboa', 'PER': 'Provid√™ncia', 'PRO': 'Provid√™ncia', 'EQU': 'Equador', 'ROD': 'Rodovi√°ria', 'TIG': 'Terminal Gentileza' } },
            2: { cor: 'Verde', estacoes: { 'SDU': 'Santos Dumont', 'ACM': 'Ant√¥nio Carlos (MAM)', 'CIN': 'Cinel√¢ndia', 'CAR': 'Carioca', 'STS': 'Sete de Setembro', 'CAN': 'Candel√°ria', 'SAB': 'S√£o Bento', 'PAM': 'Parada dos Museus', 'PNV': 'Parada dos Navios (Valongo)', 'UAR': 'Utopia (AquaRio)', 'CDS': 'Cidade do Samba (Tia Ciata)', 'SCR': 'Santo Cristo', 'GAM': 'Gamboa', 'PER': 'Provid√™ncia', 'PRO': 'Provid√™ncia', 'EQU': 'Equador', 'ROD': 'Rodovi√°ria', 'TIG': 'Terminal Gentileza' } },
            3: { cor: 'Amarela', estacoes: { 'SDU': 'Santos Dumont', 'ACM': 'Ant√¥nio Carlos (MAM)', 'CIN': 'Cinel√¢ndia', 'CAR': 'Carioca', 'STS': 'Sete de Setembro', 'CAN': 'Candel√°ria', 'SRN': 'Santa Rita (Pretos Novos)', 'CRN': 'Camerino (Rosas Negras)', 'COA': 'Cristiano Ottoni (Pequena √Åfrica)', 'CEN': 'Central' } },
            4: { cor: 'Laranja', estacoes: { 'PXV': 'Pra√ßa XV', 'COL': 'Colombo', 'TIR': 'Tiradentes', 'SAA': 'Saara', 'COA': 'Cristiano Ottoni (Pequena √Åfrica)', 'CEN': 'Central', 'VLO': 'Vila Ol√≠mpica', 'PER': 'Pereira Reis', 'GAM': 'Gamboa', 'SCR': 'Santo Cristo', 'CDG': 'Cordeiro da Gra√ßa', 'EQU': 'Equador', 'ROD': 'Rodovi√°ria', 'TIG': 'Terminal Gentileza' } }
        };

        // LISTA DE DOCUMENTOS (mantida)
        const documentosPDF = [
            { nome: "ECOPACK FALHAS", descricao: "LISTA DE FALHAS DO ECOPACK", arquivo: "PDF/1525MI falhas.pdf", tamanho: "2.4 MB", categoria: "MANUTEN√á√ÉO" },
            { nome: "GUIA OPERACIONAL", descricao: "Manual de Opera√ß√µes Padr√£o", arquivo: "PDF/guia_operacional.pdf", tamanho: "1.8 MB", categoria: "OPERA√á√ÉO" },
            { nome: "PROCEDIMENTO SEGURAN√áA", descricao: "Normas de Seguran√ßa no Trabalho", arquivo: "PDF/procedimento_seguranca.pdf", tamanho: "1.2 MB", categoria: "SEGURAN√áA" },
            { nome: "CAT√ÅLOGO PE√áAS VLT", descricao: "Lista de Pe√ßas do Ve√≠culo Leve sobre Trilhos", arquivo: "PDF/catalogo_pecas_vlt.pdf", tamanho: "3.1 MB", categoria: "CAT√ÅLOGO" },
            { nome: "MANUAL T√âCNICO BATERIA", descricao: "Especifica√ß√£o e Manuten√ß√£o de Baterias", arquivo: "PDF/manual_bateria.pdf", tamanho: "2.0 MB", categoria: "MANUTEN√á√ÉO" }
        ];

        // FUN√á√ïES DE NAVEGA√á√ÉO (mantida)
        function showPage(pageId, event) {
            // Remove a classe 'active' de todas as p√°ginas e itens do menu
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

            // Adiciona a classe 'active' ao item do menu clicado (se vier de um evento)
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }

            // Mostra a p√°gina alvo
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                // Atualiza o t√≠tulo da p√°gina
                document.getElementById('pageTitle').textContent = getPageTitle(pageId);
            }

            // --- CHAMADAS √ÄS FUN√á√ïES DE CARREGAMENTO DIN√ÇMICO ---
            // Adicione as chamadas aqui dentro da fun√ß√£o showPage
            if (pageId === 'documentacao') loadDocumentacao();
            if (pageId === 'catalogo') showCatalogoPage(); // Carrega a √°rvore
            if (pageId === 'passagem') loadPassagemData();
            if (pageId === 'relatorios') loadRelatorioPage();
            if (pageId === 'usuarios') loadUsuariosPage();
            if (pageId === 'rastreabilidade') loadRastreabilidadePage();
            if (pageId === 'laboratorio') loadLaboratorioPage();
            if (pageId === 'programacao') loadProgramacaoPage(); // Carrega o iframe da programa√ß√£o
            if (pageId === 'eva') loadEvaPage(); // Carrega o iframe da EVA
            if (pageId === 'frota') loadFrotaPage(); // NOVA CHAMADA PARA A FUN√á√ÉO DA FROTA
            // ----------------------------

            // Fecha o modal de filtro antigo se estiver aberto
            closePassagemFilterModal();
        }

        function getPageTitle(pageId) {
            const titles = {
                'dashboard': 'Dashboard',
                'programacao': 'Programa√ß√£o',
                'documentacao': 'Documenta√ß√£o',
                'catalogo': 'Cat√°logo de Materiais',
                'passagem': 'Passagem de Servi√ßo',
                'relatorios': 'Relat√≥rios',
                'usuarios': 'Usu√°rios',
                'rastreabilidade': 'Rastreabilidade',
                'laboratorio': 'Laborat√≥rio',
                'eva': 'EVA',
                'documentacao2': 'Documenta√ß√£o T√©cnica',
                'page-frota': 'Plano de Frota' // NOVO T√çTULO
            };
            return titles[pageId] || 'P√°gina';
        }

        // FUN√á√ïES PARA CARREGAR CONTE√öDO DIN√ÇMICO

        function loadDocumentacao() {
            const container = document.getElementById('documentsList');
            if (!container) return;

            container.innerHTML = documentosPDF.map(doc => `
                <div class="document-card" onclick="window.open('${doc.arquivo}', '_blank');">
                    <div class="document-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="document-title">${doc.nome}</div>
                    <div class="document-desc">${doc.descricao}</div>
                    <div class="document-size">${doc.tamanho} | ${doc.categoria}</div>
                </div>
            `).join('');
        }

        function showCatalogoPage() {
             // Certifique-se de que a fun√ß√£o loadProjectTree seja chamada
            if (typeof loadProjectTree === 'function') {
                loadProjectTree();
            } else {
                console.error("Erro: Fun√ß√£o loadProjectTree n√£o encontrada.");
            }
        }

        function loadPassagemData() {
            if (allRegistros.length === 0) {
                document.getElementById('passagem-table').innerHTML = `<tr><td colspan="6" style="text-align:center;padding:40px;" class="loading"><i class="fas fa-spinner fa-spin"></i> Carregando dados da planilha...</td></tr>`;
                fetch(REGISTRO_CSV).then(r => r.text()).then(csv => {
                    allRegistros = parseCSV(csv);
                    processPassagemFilters(); // Depois de carregar, aplica os filtros
                }).catch(error => {
                    console.error('Erro ao carregar planilha:', error);
                    document.getElementById('passagem-table').innerHTML = `<tr><td colspan="6" style="text-align:center;padding:40px;color:red;">‚ùå Erro ao carregar dados: ${error.message}</td></tr>`;
                });
            } else {
                processPassagemFilters(); // Se j√° carregados, aplica os filtros imediatamente
            }
        }

        function loadRelatorioPage() {
            // Simula carregamento de dados de relat√≥rio
            setTimeout(() => {
                document.getElementById('horasOperacionais').textContent = '1248h';
                document.getElementById('falhasReportadas').textContent = '42';
                document.getElementById('falhasResolvidas').textContent = '38';
                document.getElementById('manutPreventiva').textContent = '15';
                document.getElementById('manutCorretiva').textContent = '8';
                document.getElementById('tecnicosAlocados').textContent = '24';
            }, 500);
        }

        function loadUsuariosPage() {
            // Simula carregamento de usu√°rios
            setTimeout(() => {
                const tbody = document.querySelector('#usuarios-table tbody');
                if (!tbody) return;
                tbody.innerHTML = `<tr><td>${currentUser.usuario}</td><td>${currentUser.tipo}</td><td><button class="btn-primary" onclick="editUser('${currentUser.usuario}')">Editar</button></td></tr>`;
            }, 300);
        }

        function loadRastreabilidadePage() {
            if (allRastreabilidade.length === 0) {
                fetch(RASTREABILIDADE_CSV).then(r => r.text()).then(csv => {
                    allRastreabilidade = parseCSV(csv);
                    processRastreabilidadeFilters(); // Depois de carregar, aplica os filtros
                }).catch(error => {
                    console.error('Erro ao carregar dados de rastreabilidade:', error);
                    document.getElementById('rastreabilidade-table').innerHTML = `<tr><td colspan="5" style="text-align:center;padding:40px;color:red;">‚ùå Erro ao carregar dados: ${error.message}</td></tr>`;
                });
            } else {
                processRastreabilidadeFilters(); // Se j√° carregados, aplica os filtros imediatamente
            }
        }

        function loadLaboratorioPage() {
            if (allLaboratorio.length === 0) {
                fetch(LABORATORIO_CSV).then(r => r.text()).then(csv => {
                    allLaboratorio = parseCSV(csv);
                    processLaboratorioFilters(); // Depois de carregar, aplica os filtros
                }).catch(error => {
                    console.error('Erro ao carregar dados do laborat√≥rio:', error);
                    document.getElementById('laboratorio-table').innerHTML = `<tr><td colspan="5" style="text-align:center;padding:40px;color:red;">‚ùå Erro ao carregar dados: ${error.message}</td></tr>`;
                });
            } else {
                processLaboratorioFilters(); // Se j√° carregados, aplica os filtros imediatamente
            }
        }

        function loadProgramacaoPage() {
            console.log("Carregando iframe da Programa√ß√£o...");
            const iframe = document.getElementById('programacao-iframe');
            if (iframe) {
                iframe.src = 'https://docs.google.com/spreadsheets/d/1d4ZgT4J54m7Q4Y5mW0wQ4Y5mW0wQ4Y5mW0wQ4Y5mW0w/edit#gid=0'; // Substitua pelo link real
            } else {
                console.error("‚ùå Iframe da Programa√ß√£o n√£o encontrado!");
            }
        }

        function loadEvaPage() {
            console.log("Carregando iframe da EVA...");
            const iframe = document.getElementById('eva-iframe');
            if (iframe) {
                iframe.src = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQh0a-BMomvvOomRWYGlmoZSPG6ZuwF1jRXFrm8yhzMzizB9vWBgFiFBRyFBRRHQfVVoRppT3E8FBKS/pubhtml?gid=927195938&single=true';
            } else {
                console.error("‚ùå Iframe da EVA n√£o encontrado!");
            }
        }

        // NOVA FUN√á√ÉO PARA CARREGAR A ABA FROTA
        function loadFrotaPage() {
            console.log("Carregando conte√∫do da Frota...");
            // Obter o iframe dentro da p√°gina 'page-frota'
            const iframe = document.querySelector('#page-frota iframe');
            if (iframe) {
                // Definir o src do iframe para o link da planilha CORRETO
                iframe.src = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTe1CnKo3StuV2ajHM7_MxXdVvcySPxsFPb93QOlwRoxh961iuNiieETY4HpJVSDKTm1o4qNjC5tJSH/pubhtml?gid=1380669578&single=true';
                console.log("SRC do iframe da Frota definido.");
            } else {
                console.error("‚ùå Iframe da Frota n√£o encontrado dentro de #page-frota!");
            }
        }


        // FUN√á√ïES PARA PASSAGEM DE SERVI√áO
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(';').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(';');
                let obj = {};
                headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : '');
                return obj;
            });
        }

        function applyPassagemFilters() {
            const data = document.getElementById('passagemData').value;
            const grupo = document.getElementById('passagemGrupo').value;
            const trem = document.getElementById('passagemTrem').value.toLowerCase();
            const sistema = document.getElementById('passagemSistema').value.toLowerCase();
            const tecnico = document.getElementById('passagemTecnico').value.toLowerCase();
            const status = document.getElementById('passagemStatus').value;

            filteredPassagemData = allRegistros.filter(r => {
                const dataMatch = !data || r['DATA'] === data;
                const grupoMatch = !grupo || r['GRUPO'] === grupo;
                const tremMatch = !trem || (r['TREM'] && r['TREM'].toLowerCase().includes(trem));
                const sistemaMatch = !sistema || (r['SISTEMA'] && r['SISTEMA'].toLowerCase().includes(sistema));
                const tecnicoMatch = !tecnico || (r['T√âCNICO'] && r['T√âCNICO'].toLowerCase().includes(tecnico));
                const statusMatch = !status || r['STATUS ATUAL DO TREM'] === status;
                return dataMatch && grupoMatch && tremMatch && sistemaMatch && tecnicoMatch && statusMatch;
            });

            renderPassagemTable();
        }

        function renderPassagemTable() {
            const tableBody = document.querySelector('#passagem-table tbody');
            if (!tableBody) return;

            if (filteredPassagemData.length === 0) {
                 tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding: 20px;">Nenhum registro encontrado com os filtros aplicados.</td></tr>`;
                 return;
            }

            tableBody.innerHTML = filteredPassagemData.map(r => {
                const data = r['DATA'] || 'N/A';
                const nome = r['NOME'] || 'N/A';
                const trem = r['TREM'] || 'N/A';
                const sistema = r['SISTEMA'] || 'N/A';
                const descricao = r['DESCRI√á√ÉO DETALHADA'] || '';
                const status = r['STATUS ATUAL DO TREM'] || 'N√ÉO INFORMADO';
                return `<tr><td>${data}</td><td>${nome}</td><td>${trem}</td><td>${sistema}</td><td>${descricao}</td><td>${status}</td></tr>`;
            }).join('');
        }

        function clearPassagemFilters() {
            ['passagemData', 'passagemGrupo', 'passagemTrem', 'passagemSistema', 'passagemTecnico', 'passagemStatus'].forEach(id => document.getElementById(id).value = '');
            filteredPassagemData = [];
            renderPassagemTable(); // Mostra todos os dados novamente
        }

        // FUN√á√ïES PARA RASTREABILIDADE
        function searchRastreabilidade() {
            const term = document.getElementById('searchRastreabilidade').value.toLowerCase();
            filteredRastreabilidadeData = allRastreabilidade.filter(r => {
                return Object.values(r).some(v => v.toLowerCase().includes(term));
            });
            renderRastreabilidadeTable();
        }

        function renderRastreabilidadeTable() {
            const tableBody = document.querySelector('#rastreabilidade-table tbody');
            if (!tableBody) return;

            if (filteredRastreabilidadeData.length === 0) {
                 tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 20px;">Nenhum item encontrado.</td></tr>`;
                 return;
            }

            tableBody.innerHTML = filteredRastreabilidadeData.map(r => {
                const codigo = r['C√ìDIGO'] || 'N/A';
                const descricao = r['DESCRI√á√ÉO'] || 'N/A';
                const trem = r['TREM'] || 'N/A';
                const localizacao = r['LOCALIZA√á√ÉO ATUAL'] || 'N/A';
                const data = r['DATA √öLTIMA ATUALIZA√á√ÉO'] || 'N/A';
                return `<tr><td>${codigo}</td><td>${descricao}</td><td>${trem}</td><td>${localizacao}</td><td>${data}</td></tr>`;
            }).join('');
        }

        function processRastreabilidadeFilters() {
            // Para rastreabilidade, por enquanto, apenas mostra todos os dados carregados
            filteredRastreabilidadeData = [...allRastreabilidade];
            renderRastreabilidadeTable();
        }

        // FUN√á√ïES PARA LABORAT√ìRIO
        function processLaboratorioFilters() {
            // Para laborat√≥rio, por enquanto, apenas mostra todos os dados carregados
            filteredLaboratorioData = [...allLaboratorio];
            renderLaboratorioTable();
        }

        function renderLaboratorioTable() {
            const tableBody = document.querySelector('#laboratorio-table tbody');
            if (!tableBody) return;

             if (filteredLaboratorioData.length === 0) {
                 tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 20px;">Nenhum teste encontrado.</td></tr>`;
                 return;
            }

            tableBody.innerHTML = filteredLaboratorioData.map(r => {
                const id = r['ID_TESTE'] || 'N/A';
                const componente = r['COMPONENTE'] || 'N/A';
                const resultado = r['RESULTADO'] || 'N/A';
                const data = r['DATA'] || 'N/A';
                const tecnico = r['T√âCNICO_RESPONSAVEL'] || 'N/A';
                return `<tr><td>${id}</td><td>${componente}</td><td>${resultado}</td><td>${data}</td><td>${tecnico}</td></tr>`;
            }).join('');
        }

        // FUN√á√ïES PARA DOCUMENTOS
        function searchDocuments() {
            const term = document.getElementById('searchDocumentacao').value.toLowerCase();
            const cards = document.querySelectorAll('#documentsList .document-card');
            cards.forEach(card => {
                const name = card.getAttribute('onclick').toLowerCase(); // Procura no nome do arquivo
                card.style.display = name.includes(term) ? 'block' : 'none';
            });
        }

        function searchDocuments2() {
            const term = document.getElementById('searchDocumentacao2').value.toLowerCase();
            const cards = document.querySelectorAll('#documentsList2 .document-card');
            cards.forEach(card => {
                const name = card.getAttribute('onclick').toLowerCase(); // Procura no nome do arquivo
                card.style.display = name.includes(term) ? 'block' : 'none';
            });
        }

        // FUN√á√ïES PARA PERFIL DO USU√ÅRIO
        function openProfileModal() {
            const usuario = currentUser.usuario;
            // Tenta carregar dados mais detalhados da planilha de base de cadastro
            loadBaseCadastro(usuario).then(() => {
                // Se encontrar na planilha, preenche com os dados
                const userDetails = baseCadastroData.find(u => u.USUARIO === usuario);
                if (userDetails) {
                    document.getElementById('perfil-nome').textContent = `${userDetails.NOME} ${userDetails.SOBRENOME}`;
                    document.getElementById('perfil-email').textContent = userDetails.EMAIL || 'N√£o informado';
                    const telefone = userDetails.TELEFONE || userDetails.CELULAR || 'N√£o informado';
                    const endereco = `${userDetails.ENDERECO}, ${userDetails.NUMERO}, ${userDetails.BAIRRO}, ${userDetails.CIDADE} - ${userDetails.ESTADO}`;
                    document.getElementById('perfil-telefone').innerHTML = telefone !== 'N√£o informado' ? `<a href="https://wa.me/55${telefone.replace(/\D/g, '')}" target="_blank" class="modal-link"><i class="fab fa-whatsapp"></i> ${telefone}</a>` : 'N√£o informado';
                    document.getElementById('perfil-endereco').textContent = endereco;
                    document.getElementById('perfil-matricula').textContent = userDetails.MATRICULA || 'N√£o informado';
                } else {
                    // Se n√£o encontrar na planilha, usa os dados do login e preenche o resto com '-'
                    document.getElementById('perfil-nome').textContent = currentUser.nome || usuario;
                    document.getElementById('perfil-email').textContent = 'N√£o informado';
                    document.getElementById('perfil-telefone').textContent = 'N√£o informado';
                    document.getElementById('perfil-endereco').textContent = 'N√£o informado';
                    document.getElementById('perfil-matricula').textContent = 'N√£o informado';
                }
                document.getElementById('perfil-usuario').textContent = usuario;
                document.getElementById('perfil-tipo').textContent = currentUser.tipo || 'USU√ÅRIO';
            }).catch(error => {
                 console.error("Erro ao carregar dados do perfil:", error);
                 // Se der erro ao carregar a planilha, preenche com dados b√°sicos do login
                 document.getElementById('perfil-nome').textContent = currentUser.nome || usuario;
                 document.getElementById('perfil-usuario').textContent = usuario;
                 document.getElementById('perfil-email').textContent = 'N√£o informado';
                 document.getElementById('perfil-telefone').textContent = 'N√£o informado';
                 document.getElementById('perfil-endereco').textContent = 'N√£o informado';
                 document.getElementById('perfil-matricula').textContent = 'N√£o informado';
                 document.getElementById('perfil-tipo').textContent = currentUser.tipo || 'USU√ÅRIO';
            });

            document.getElementById('profileModal').style.display = 'block';
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function loadUserProfile(usuario) {
            // Esta fun√ß√£o pode ser usada para carregar informa√ß√µes espec√≠ficas do usu√°rio em outros lugares da UI
            // Por enquanto, apenas atualiza o nome e tipo no cabe√ßalho
            document.getElementById('userName').textContent = usuario;
            document.getElementById('userRole').textContent = currentUser.tipo;
            const initials = usuario.split('.').map(n => n[0].toUpperCase()).join('');
            document.getElementById('userInitials').textContent = initials;

            // Esconde itens do menu se n√£o for ADMIN
            if (currentUser.tipo !== 'ADMIN') {
                document.getElementById('usuarios-menu').style.display = 'none';
                document.getElementById('relatorios-menu').style.display = 'none';
            }
        }

        function loadBaseCadastro(usuario) {
            // Carrega a planilha de base de cadastro uma vez e armazena em baseCadastroData
            return new Promise((resolve, reject) => {
                if (baseCadastroData.length > 0) { // Se j√° estiver carregada
                    resolve();
                    return;
                }

                fetch(BASE_CADASTRO_URL)
                .then(response => {
                    if (!response.ok) throw new Error(`Erro HTTP! status: ${response.status}`);
                    return response.text();
                })
                .then(text => {
                    // Tenta encontrar o in√≠cio do JSON dentro do CSV
                    const jsonMatch = text.match(/\{.*\}/s); // Captura o primeiro bloco JSON
                    if (!jsonMatch) {
                        throw new Error("Nenhum bloco JSON encontrado no arquivo da base de cadastro.");
                    }
                    const jsonStr = jsonMatch[0];
                    baseCadastroData = JSON.parse(jsonStr);
                    console.log("Dados da base de cadastro carregados:", baseCadastroData);
                    resolve();
                })
                .catch(error => {
                    console.error("Erro ao carregar arquivo da base de cadastro:", error);
                    reject(error);
                });
            });
        }

        // FUN√á√ïES PARA CAT√ÅLOGO (√Årvore)
        function loadProjectTree() {
            const treeContainer = document.getElementById('treeDisplay');
            if (!treeContainer) return;

            // Mostrar indicador de carregamento
            treeContainer.innerHTML = `<div class="loading" style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Carregando estrutura...</div>`;

            // Carregar dados do JSON
            fetch(PROJECT_DATA_URL)
            .then(response => response.json())
            .then(data => {
                // Processar dados planos em uma estrutura de √°rvore
                projectTreeData = processDataIntoTree(data);
                // Renderizar a √°rvore
                treeContainer.innerHTML = `<ul>${renderTreeItems(projectTreeData)}</ul>`;
            })
            .catch(error => {
                console.error('Erro ao carregar ou processar dados do cat√°logo:', error);
                treeContainer.innerHTML = `<p style="color: red; text-align: center;">Erro ao carregar estrutura: ${error.message}</p>`;
            });
        }

        function processDataIntoTree(flatData) {
            const map = new Map();
            // Primeira passagem: cria todos os n√≥s e os coloca em um mapa
            flatData.forEach(item => {
                const levels = [
                    { name: item.NIVEL1, level: 1 },
                    { name: item.NIVEL2, level: 2 },
                    { name: item.NIVEL3, level: 3 },
                    { name name: item.NIVEL4, level: 4 },
                    { name: item.NIVEL5, level: 5 },
                    { name: item.DESCRICAO, level: 6, id: item.CODIGO } // O √∫ltimo n√≠vel √© a descri√ß√£o com o c√≥digo
                ];
                let currentPath = '';
                levels.forEach(lvl => {
                    if (lvl.name) {
                        const id = currentPath + lvl.name;
                        if (!map.has(id)) {
                            map.set(id, {
                                id: id,
                                name: lvl.name,
                                level: lvl.level,
                                children: [],
                                codigo: lvl.id || null // Armazena o c√≥digo apenas no √∫ltimo n√≠vel
                            });
                        }
                        currentPath += lvl.name + '_'; // Constr√≥i um caminho √∫nico
                    }
                });
            });

            // Segunda passagem: organiza os n√≥s em uma estrutura hier√°rquica
            const rootNodes = [];
            map.forEach(node => {
                const pathParts = node.id.split('_');
                if (pathParts.length === 1) {
                    rootNodes.push(node);
                } else {
                    const parentPath = pathParts.slice(0, -1).join('_');
                    const parent = map.get(parentPath);
                    if (parent) {
                        parent.children.push(node);
                    }
                }
            });

            return rootNodes;
        }

        function renderTreeItems(nodes) {
            if (!nodes || nodes.length === 0) return '';
            return nodes.map(node => {
                const hasChildren = node.children.length > 0;
                const itemClass = node.codigo ? 'tree-item' : ''; // Adiciona classe apenas se for um item folha com c√≥digo
                const icon = hasChildren ? (node.expanded ? 'fas fa-folder-open' : 'fas fa-folder') : 'fas fa-file';
                return `
                    <li>
                        <div class="${itemClass}" onclick="${node.codigo ? `selectCatalogItem('${node.codigo}', '${node.name}')` : (hasChildren ? `toggleTree(this)` : '')}">
                            <i class="${icon}"></i> ${node.name} ${node.codigo ? `(${node.codigo})` : ''}
                        </div>
                        ${hasChildren ? `<ul style="display: ${node.expanded ? 'block' : 'none'};">${renderTreeItems(node.children)}</ul>` : ''}
                    </li>
                `;
            }).join('');
        }

        function toggleTree(element) {
            const ul = element.nextElementSibling;
            if (ul && ul.tagName === 'UL') {
                ul.style.display = ul.style.display === 'none' ? 'block' : 'none';
                // Atualiza o √≠cone da pasta
                const icon = element.querySelector('i');
                if (icon) {
                    icon.className = ul.style.display === 'none' ? 'fas fa-folder' : 'fas fa-folder-open';
                }
            }
        }

        function selectCatalogItem(codigo, descricao) {
            alert(`Item selecionado: ${descricao} (C√≥digo: ${codigo})`);
            // Aqui voc√™ pode adicionar l√≥gica para exibir detalhes do item, adicionar a um pedido, etc.
        }

        // OUTRAS FUN√á√ïES
        function addUser() {
            alert('Funcionalidade de adicionar usu√°rio ainda n√£o implementada.');
        }

        function editUser(usuario) {
            alert(`Editar usu√°rio: ${usuario}`);
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html'; // Redireciona para a p√°gina de login
            }
        }

        function updateOperationClock() {
            const now = new Date();
            // Formato DD/MM/YYYY HH:MM:SS
            const dateStr = now.toLocaleDateString('pt-BR');
            const timeStr = now.toLocaleTimeString('pt-BR');
            document.getElementById('operationClock').innerHTML = `${dateStr} <span>${timeStr}</span>`;
        }

        function updateMotivationalQuote() {
            const quoteElement = document.getElementById('motivationalQuote');
            if (quoteElement) {
                const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
                quoteElement.textContent = motivationalQuotes[randomIndex];
            }
        }

        // FUN√á√ÉO PARA FILTRO DE PASSAGEM (MODAL ANTIGO - REMOVIDO)
        function openPassagemFilterModal() {
            document.getElementById('passagemFilterModal').classList.add('show');
        }
        function closePassagemFilterModal() {
            const modal = document.getElementById('passagemFilterModal');
            if (modal) modal.classList.remove('show');
        }
        function applyPassagemFilterOld() {
            const grupo = document.getElementById('passagemGrupoOld').value;
            const dataStr = document.getElementById('passagemDataOld').value;
            if (!dataStr) {
                alert('Por favor, selecione uma data.');
                return;
            }
            document.getElementById('passagemGrupo').value = grupo;
            document.getElementById('passagemData').value = dataStr;
            applyPassagemFilters();
            closePassagemFilterModal();
        }

        // INICIALIZA√á√ÉO (mantida)
        document.addEventListener('DOMContentLoaded', function() {
            // Carrega o perfil do usu√°rio
            const usuario = currentUser.usuario;
            document.getElementById('userName').textContent = usuario;
            document.getElementById('userRole').textContent = currentUser.tipo;
            const initials = usuario.split('.').map(n => n[0].toUpperCase()).join('');
            document.getElementById('userInitials').textContent = initials;

            if (currentUser.tipo !== 'ADMIN') {
                document.getElementById('usuarios-menu').style.display = 'none';
                document.getElementById('relatorios-menu').style.display = 'none';
            }
            loadUserProfile(usuario);

            // Inicializa rel√≥gio e frase motivacional
            updateOperationClock();
            setInterval(updateOperationClock, 1000);
            updateMotivationalQuote();
            setInterval(updateMotivationalQuote, 300000); // Atualiza a cada 5 minutos

            // Carrega dados iniciais se necess√°rio (ex: passagem, rastreabilidade)
            // loadPassagemData(); // Chamada autom√°tica √© feita ao abrir a aba
            // loadRastreabilidadePage(); // Chamada autom√°tica √© feita ao abrir a aba
        });

    }// FUN√á√ÉO PARA CARREGAR PERFIL DO USU√ÅRIO (mantida)
    </script>
</body>
</html>
